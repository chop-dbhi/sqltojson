# SQL to JSON

Tool to build/export JSON documents from nested SQL queries.

Currently the data output is in the [bulk format](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html) for loading into Elasticsearch. In addition, a base [mapping file](https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html) is auto-generated by inferring the types from the data.

## Config

Create a config file. See the included [config.example.yaml](./config.example.yaml) for a real world example.

- `workers` - Number of workers. Defaults to 10.
- `connections` - Max number of connections to the database. Defaults to 10.
- `files.data` - Name of the file to write the data to. Defaults to `data.json`. For more control, set the name to `-` which will write the data to stdout. This makes it easy to pipe to `gzip` or perform other operations especially for large exports.
- `files.mapping` - Name of the file to write the mapping to.
- `index` - Name of the ES index the data applies to.
- `type` - Name of the ES document type the data applies to.
- `schema` - The schema of the documents being created.

## Usage

Create a config file and then run.

```bash
sqltojson -config config.yaml
```

## Elasticsearch

The output files are named `data.json` and `mapping.json` by default.

### Create Index

```bash
curl -XPOST http://192.168.99.100:9200/my_index -d @mapping.json
```

### Load Data

```bash
curl -XPOST http://192.168.99.100:9200/_bulk --data-binary @data.json
```
